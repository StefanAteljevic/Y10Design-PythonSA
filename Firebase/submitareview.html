<html>
    <head>

        <link rel="stylesheet" href="indexstyle.css">

        <!-- HERE ARE YOUR FIREBASE and GOOGLE AUTHENICATION IMPORTS -->
        <!-- The core Firebase JS SDK is always required and must be listed first -->
        <script src="https://www.gstatic.com/firebasejs/7.6.0/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.6.0/firebase-analytics.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.6.0/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.6.0/firebase-database.js"></script>
        <script src="https://apis.google.com/js/platform.js" async defer></script>

        <!-- Add SDKs for Firebase products that you want to use 
          https://firebase.google.com/docs/web/setup#available-libraries -->
 
    </head>

    <body style="background-color:#DDA2A2;">


      <div class="topnav">
        <a href="index.html">Home</a>
        <a class="active" href="submitareview.html">Submit A Review</a>
        <a href="contact.html">About Us</a>
      </div>
      
            <title> Submit A Review </title>

        <div class="submit-image"></div>

        <div class="submit-text">
            <h1>Submit A Review</h1>
            <p>Below, you will find all of the information that you need to complete your review!</p>
        </div>   

        <div class="subtitle">
          <h1 style="background-color:#000000;">The information you request will be displayed below:</h1>
        </div>


   <!--       HERE IS YOUR HTML CODE TO SET TEXT -->
            
          <!-- <div class="leaveareview">
            <center><h3>Leave a review!</h3></center>
          </div> -->

          <div class="rules">
            <center><h4>Rules that every user must follow:</h4></center>
          </div>

          <div class="rules2">
            <center><h5>1. All reviews must be serious.</h5></center>
            <center><h6>2. All reviews must contain a number rating from 0 to 10 at the end of the review.</h6></center>  
            <center><h7>3. All review lengths are welcome.</h7></center>                      
          </div>


            <button onclick = "signin()" >Sign In</button>
                       
            <textarea id="game" placeholder="Enter Game"></textarea>
            <textarea id="review" placeholder="Enter Review"></textarea>
            <!-- <input type="text" id="game" placeholder="Enter Game"> -->
            <!-- <input type="text" id="review" placeholder="Enter Review"> -->

            <button onclick = "setData()" >Send review</button>
            <button onclick = "getData()" >Get review</button>

            <p>Current Data:</p>
            
<!--             ol means ordered list -->
            <p><ol id="gameList"></ol><ol id="reviewList"></ol></p> 




        <!-- This is code for the forms -->
        <!-- <form> --> <!-- INSERT OTHER SITES HERE THAT WILL RECIEVE INFORMATION-->
       <!--    Game:<br>
          <input type="text" name="game" value="~Insert Game Here~">
          <br>
          Date:<br>
          <input type="text" name="date" value="~Insert Date Here~">
          <br><br>
          <input type="submit" value="Submit">
        </form> 
 -->



    </body>


    <script>

        // Variables created here to be used throughout the program

        var provider = new firebase.auth.GoogleAuthProvider();
        // var userId = document.getElementById("uid").innerHTML;
        
        // Your web app's Firebase configuration that we copy-and-paste from 
        // the Firebase setup
        var config = {

          apiKey: "AIzaSyDTVLBlkzZxHfV02pbFKcIkOZnLPr76fbI",
          authDomain: "ucc2019-5bec6.firebaseapp.com",
          databaseURL: "https://ucc2019-5bec6.firebaseio.com",
          projectId: "ucc2019-5bec6",
          storageBucket: "ucc2019-5bec6.appspot.com",
          messagingSenderId: "705711290007",
          appId: "1:705711290007:web:880929afd7593fdca01bd2",
          measurementId: "G-SY9WQ7NV7C"

          };

        firebase.initializeApp(config);
        //firebase.analytics();

        // Authentication Check: to see if you are logged in
        firebase.auth().onAuthStateChanged(function(user) {
            if (user == null) {
                document.getElementById("uid").innerHTML = "not logged in";
                return;
            } else {
                userId = user.uid; // you can also get .displayName, .photoURL, .email
                document.getElementById("uid").innerHTML = userId; // display Google uid on page
                
            } // end user null check
        }); // end check auth state


        // Functions that will be used to "get" and "set" data, among other "helper"
        // functions too...

        function signin() {
            var provider = new firebase.auth.GoogleAuthProvider();
            firebase.auth().signInWithRedirect(provider).then(function(result) { 
                window.location.replace("fbtest.html");
            });
        } // end signin 

        function clearFields() {
          document.getElementById("game").value = "";
          document.getElementById("review").value = "";
        }

        function setData() {

            // Create a database object that we can refer to
            var database = firebase.database();

            // Create a reference to a particular location or "node" called StudentInfo
            var ref = database.ref('Reviews');

            // Grab the Name, Subject, and Grade obtained from the HTML frontend textboxes
            var sgame = document.getElementById("game").value;
            var sreview = document.getElementById("review").value;
            
            // Create a JSON object to add to the database with user-inputted data
            var data = {
                game: sgame,
                review: sreview,
            }
            // "PUSH" means we add something to the database
            ref.push(data);

            clearFields();
        } // end setdata

        function getData() {

            // Create a database object that we can refer to
            var database = firebase.database();

            // Create a reference to a particular location or "node"
            // 'StudentInfo'is the name of the main branch in the database
            var ref = database.ref('Reviews');

            // we will make reference to each 'value' of a database object which will have 
            // two helper functions latched "on" to it to perform additional tasks 
            // - either we have access to data values, or we don't and there is an error

            ref.on('value', gotData, errData) 
            // jump to the helper function...think of 'value' as the parameter that is passed

            clearFields();

        } // end getdata

        function gotData(data){

            // clear items from previously created lists
            document.getElementById("gameList").innerHTML = "";
            document.getElementById("reviewList").innerHTML = "";
            
            // collect all of the unique objects ('keys' or id's) out of the database
            var reviewData = data.val(); // access the data 'value' of each student 'object' 
            var keys = Object.keys(reviewData);
            console.log(keys);

            // iterate through the unique object id's and grab data fields: 'name', 'subject', 'mark'
            for (var i = 0; i < keys.length; i++){
              var k = keys[i];
              var name = reviewData[k].game;
              var subject = reviewData[k].review;

              // DISPLAY STUDENT NAMES
              // Create a reference to the ordered list called 'studentList'
              // called 'oListStudent'
              var oListGame = document.getElementById('gameList');
              var entry = document.createElement('li'); // a list element to be added to the ordered list
              entry.appendChild(document.createTextNode(game));
              oListGame.appendChild(entry);

              var oListReview = document.getElementById('reviewList');
              var entry = document.createElement('li'); // a list element to be added to the ordered list
              entry.appendChild(document.createTextNode(review));
              oListReview.appendChild(entry);
              
              // AJ: we only need to send information to the console window when we
              // are debugging our code of errors
              // console.log (keys[i]);
              // console.log (subject);

            }
        }

        function errData(err){
            console.log('Error!')
            console.log(err)
        }

    </script>

</html>